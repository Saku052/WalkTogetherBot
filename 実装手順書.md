# AI Tweet Generation Implementation Guide / AI ツイート生成機能実装手順書

## Project Overview / プロジェクト概要

**Project Name**: Twitter Bot AI Text Auto-Generation Feature  
**プロジェクト名**: Twitter Bot AI文章自動生成機能

**Purpose**: Enhance the existing WalkTogetherBot by implementing real-time AI-generated tweet content for Rakuten Mobile affiliate tweets, improving content diversity and quality.  
**目的**: 定時実行される楽天モバイル提携ツイートをAIでリアルタイム生成し、投稿の多様性と品質を向上させる

---

## Implementation Steps / 実装手順

### Step 1: Environment Setup / ステップ1: 環境準備

1. **Obtain OpenAI API Key** / OpenAI APIキーの取得
2. **Add API key to .env file** / `.env`ファイルにAPIキー追加
3. **Install openai package** / `openai`パッケージのインストール

### Step 2: AI Generation Feature Implementation / ステップ2: AI生成機能の実装

1. **Create aiGenerator.js module** / `aiGenerator.js`モジュール作成
2. **Implement OpenAI API communication** / OpenAI APIとの通信機能実装
3. **Define prompt templates** / プロンプトテンプレート定義

### Step 3: Integration with Existing System / ステップ3: 既存システムとの統合

1. **Modify index.js** / `index.js`の修正
2. **Integrate AI generation with cron jobs** / cronジョブでAI生成機能呼び出し
3. **Implement error handling** / エラーハンドリング実装

### Step 4: Testing and Validation / ステップ4: テスト・検証

1. **API connection testing** / API接続テスト
2. **Generated content quality verification** / 生成文章の品質確認
3. **Production environment validation** / 本番環境での動作確認

---

## Requirements Specification / 要件定義書

### Functional Requirements / 機能要件

| Function ID | Function Name | Description | Priority |
|-------------|---------------|-------------|----------|
| F001 | AI Text Generation | Generate tweet content using OpenAI API | High |
| F002 | Scheduled Execution Integration | Integrate with existing cron jobs for real-time generation | High |
| F003 | Error Handling | Fallback functionality when API fails | Medium |
| F004 | Generation Log Management | Record and manage generated tweet content | Low |

| 機能ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| F001 | AI文章生成 | OpenAI APIを使用してツイート文を自動生成 | 高 |
| F002 | 定時実行連携 | 既存cronジョブと連携してリアルタイム生成 | 高 |
| F003 | エラーハンドリング | API失敗時のフォールバック機能 | 中 |
| F004 | 生成ログ管理 | 生成されたツイート文の記録・管理 | 低 |

### Non-Functional Requirements / 非機能要件

| Item | Requirement | Reason |
|------|-------------|--------|
| Response Time | Within 10 seconds | For stable cron job execution |
| Availability | 99% | Ensure reliability of scheduled posts |
| Cost | Under $10/month | Cost control |
| Security | API key encryption | Prevent information leakage |

| 項目 | 要件 | 理由 |
|------|------|------|
| レスポンス時間 | 10秒以内 | cronジョブの安定実行のため |
| 可用性 | 99% | 定時投稿の信頼性確保 |
| コスト | 月額1000円以内 | 運用コスト抑制 |
| セキュリティ | APIキー暗号化 | 情報漏洩防止 |

### Constraints / 制約条件

- Maintain existing code structure as much as possible / 既存コード構造を可能な限り維持
- Comply with Twitter API limitations / Twitter API制限の遵守
- Maintain consistency with Rakuten Mobile affiliate content / 楽天モバイル提携内容の一貫性維持

---

## Data Model Design / データモデル設計書

### System Architecture / システム構成図

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Cron Scheduler │────│  AI Generator   │────│   Twitter API   │
│    (index.js)   │    │ (aiGenerator.js)│    │   (Post Tweet)  │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                        │
         └────────────────────────┼─────────────────────────────────
                                  │
                        ┌─────────────────┐
                        │   OpenAI API    │
                        │ (Text Generation)│
                        └─────────────────┘
```

### Data Structures / データ構造

#### 1. Environment Variables (.env) / 環境変数設定

```env
# Existing Twitter API configuration / 既存のTwitter API設定
API_KEY=xxx
API_SECRET_KEY=xxx
ACCESS_TOKEN=xxx
ACCESS_TOKEN_SECRET=xxx

# New addition / 新規追加
OPENAI_API_KEY=xxx
```

#### 2. AIGenerator Class / AIGeneratorクラス

```javascript
class AIGenerator {
  constructor(apiKey)
  async generateTweet(promptType)
  buildPrompt(promptType)
  handleApiError(error)
}
```

#### 3. Prompt Templates / プロンプトテンプレート

```javascript
const PROMPT_TEMPLATES = {
  rakuten_mobile: {
    system: "Generate engaging tweet content for Rakuten Mobile",
    themes: ["Cost Saving", "Point Utilization", "Unlimited Data", "Efficiency", "Self-Investment"]
  }
}
```

#### 4. Response Format / レスポンス形式

```javascript
{
  success: boolean,
  content: string,
  error?: string,
  timestamp: Date,
  promptType: string
}
```

#### 5. Log Format / ログ形式

```javascript
{
  timestamp: ISO8601,
  action: "AI_GENERATE" | "TWEET_POST" | "ERROR",
  content: string,
  success: boolean,
  error?: string
}
```

---

## Implementation Checklist / 実装チェックリスト

- [x] Install required packages / 必要パッケージのインストール
- [x] Set up environment variables / 環境変数の設定
- [x] Create AI generator module / AI生成モジュールの作成
- [x] Modify existing cron jobs / 既存cronジョブの修正
- [x] Implement error handling / エラーハンドリングの実装
- [x] Test API connectivity / API接続テスト
- [x] Validate generated content / 生成コンテンツの検証
- [ ] Deploy to production / 本番環境へのデプロイ

---

## Notes for Development / 開発時の注意事項

1. **API Rate Limits**: Be mindful of OpenAI API rate limits / OpenAI APIのレート制限に注意
2. **Cost Management**: Monitor API usage costs / API使用コストの監視
3. **Content Quality**: Ensure generated content maintains brand consistency / 生成コンテンツのブランド一貫性確保
4. **Error Recovery**: Implement robust fallback mechanisms / 堅牢なフォールバック機構の実装